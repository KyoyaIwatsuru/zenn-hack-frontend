name: Test Deployment Status Events

on:
  deployment_status:
    types: [success, failure, error, inactive, pending]
  push:
    branches: [main]

jobs:
  test-event:
    runs-on: ubuntu-latest
    steps:
      - name: Debug deployment status
        run: |
          echo "Event name: ${{ github.event_name }}"
          echo "Deployment status: ${{ github.event.deployment_status.state }}"
          echo "Environment URL: ${{ github.event.deployment_status.environment_url }}"
          echo "Target URL: ${{ github.event.deployment_status.target_url }}"
          echo "Full event:"
          echo '${{ toJson(github.event) }}'
          
      - name: Test Discord notification
        if: github.event_name == 'deployment_status'
        run: |
          MESSAGE="🧪 Test: Deployment Status Event Detected!"
          MESSAGE="$MESSAGE\nStatus: ${{ github.event.deployment_status.state }}"
          if [ "${{ github.event.deployment_status.environment_url }}" != "" ]; then
            MESSAGE="$MESSAGE\nURL: ${{ github.event.deployment_status.environment_url }}"
          fi
          
          echo "Sending message: $MESSAGE"
          
          # Discordに送信（DISCORD_WEBHOOK_URLが設定されている場合のみ）
          if [ "${{ secrets.DISCORD_WEBHOOK_URL }}" != "" ]; then
            curl -X POST -H "Content-Type: application/json" \
            -d "{\"content\": \"$MESSAGE\"}" \
            "${{ secrets.DISCORD_WEBHOOK_URL }}"
          else
            echo "DISCORD_WEBHOOK_URL not set, skipping Discord notification"
          fi